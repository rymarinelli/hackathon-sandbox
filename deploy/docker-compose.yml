version: "3.9"

services:
  gateway:
    build: ..
    environment:
      APP_NAME: gateway
      APP_HOST: 0.0.0.0
      APP_PORT: 8000
      LOG_LEVEL: INFO
      REDIS_URL: redis://redis:6379/0
      READY_REDIS_CHECK: "true"
      OTEL_SERVICE_NAME: gateway
      # Uncomment to export traces to an OTLP collector
      # OTEL_EXPORTER_OTLP_ENDPOINT: http://otel-collector:4317
      # OTEL_EXPORTER_OTLP_INSECURE: "true"
    ports:
      - "8000:8000"
    depends_on:
      - redis

  redis:
    image: redis:7.2
    ports:
      - "6379:6379"
    command: ["redis-server", "--save", "", "--appendonly", "no"]

  # otel-collector:
  #   image: otel/opentelemetry-collector-contrib:0.96.0
  #   command: ["--config=/etc/otel-collector-config.yaml"]
  #   volumes:
  #     - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml:ro
